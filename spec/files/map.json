[
  // simple assignment/copy
  {
    "args" : ["MAP tables:items USING a = @x.y.z;"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "tables", "key" : "items" },
          "assignments" : [
            { "column" : "a", "type" : "reference", "section" : "_context", "key" : "x.y.z" }
          ]
        }
      ]
    }
  },
  // reference the vtable
  {
    "args" : ["MAP $ USING a = @x.y.z;"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "_virtual" },
          "assignments" : [
            { "column": "a", "type" : "reference", "section" : "_context", "key" : "x.y.z" }
          ]
        }
      ]
    }
  },
  // multiple assignments
  {
    "args" : ["MAP tables:items USING a = @x.y.z USING b=@p.q USING c = 2 USING d='s';"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "tables", "key" : "items" },
          "assignments" : [
            { "column": "a", "type" : "reference", "section" : "_context", "key" : "x.y.z" },
            { "column": "b", "type" : "reference", "section" : "_context", "key" : "p.q" },
            { "column": "c", "type" : "number", "value" : "2" },
            { "column": "d", "type" : "string", "value" : "s" }
          ]
        }
      ]
    }
  },
  {
    "args" : ["MAP tables:items USING a = multiply(add(@b, 2), 4);"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "tables", "key" : "items" },
          "assignments" : [
            {
              "column" : "a",
              "type" : "function",
              "name" : "multiply",
              "args" : [
                {
                  "type" : "function",
                  "name" : "add",
                  "args" : [
                    { "type" : "reference", "section" : "_context", "key" : "b" },
                    { "type" : "number", "value" : "2" }
                  ]
                },
                { "type" : "number", "value" : "4" }
              ]
            }
          ]
        }
      ]
    }
  }
]
