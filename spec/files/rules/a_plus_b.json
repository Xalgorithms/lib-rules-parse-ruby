{
  "meta" : {
    "version" : "0.0.1",
    "runtime" : "0.4.0",
    "criticality" : "experimental",
    "manager" : "Joseph Potvin <jpotvin@xalgorithms.org>",
    "maintainer" : "Don Kelly <karfai@gmail.com>"
    
  },
  "effective" : [
    {
      "timezone" : "America/Toronto",
      "starts" : "2018-04-01T00:00",
      "ends" : "9999-12-30T23:59",
      "jurisdictions": ["CA-ON", "CA-QC"]
    }
  ],
  "whens" : {
    "envelope": [
      {
        "expr": {
          "left": {"section": "envelope", "key": "type", "type": "reference"},
          "right": {"type": "string", "value": "invoice"}, "op": "eq"}
      }
    ],
    "item": [
      {
        "expr": {
          "left": {"section": "item", "key": "quantity.value", "type": "reference"},
          "right": {"type": "number", "value": "0"}, "op": "gt"}
      },
      {
        "expr": {
          "left": {"section": "item", "key": "id.value", "type": "reference"},
          "right": {"type": "string", "value": "a"}, "op": "eq"}
      }
    ]
  },
  "steps" : [
    {"reference": {"package": "org.xalgorithms.examples.a_plus_b", "id": "all_bs", "version": "0.0.1", "name": "all_bs"}, "indexes": [], "name": "require"},
    {
      "table_name": "changes",
      "columns": [
        {"table": {"section": "table", "key": "items", "type": "reference"}, "sources": [{"columns": []}]},
        {"table": {"section": "table", "key": "all_bs", "type": "reference"}, "sources": [{"columns": []}]}
      ],
      "name": "assemble"
    },
    {
      "table": {"section": "table", "key": "changes", "type": "reference"},
      "filters": [
        {
          "left": {"section": "_context", "key": "id.value", "type": "reference"},
          "right": {"section": "_context", "key": "code", "type": "reference"},
          "op": "eq"
        }
      ],
      "name": "filter"
    },
    {
      "table": {"section": "table", "key": "changes", "type": "reference"},
      "assignments": [
        {"source": {"type": "function", "name": "add", "args": [{"section": "_context", "key": "price.value", "type": "reference"}, {"section": "_context", "key": "b", "type": "reference"}]}, "target": "new_price"}
      ],
      "name": "map"
    },
    {
      "table": {"section": "table", "key": "items", "type": "reference"},
      "revisions": [
        {
          "op": "update",
          "source": {
            "column": "price.value",
            "table": {"section": "table", "key": "changes", "type": "reference"}
          }
        }
      ],
      "name": "revise"
    }
  ]
}
