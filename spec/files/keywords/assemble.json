[
  {
    "args": ["ASSEMBLE table0 COLUMN c0 FROM tables:table1 WHEN x.y == @a.b;"],
    "expects" : {
      "steps" : [
        {
          "name" : "assemble", "table_name" : "table0", "columns" : [
            {
              "table" : { "type" : "reference", "section" : "tables", "key" : "table1" },
              "sources" : [
                {
                  "source": "c0", "name" : "c0", "expr" : {
                    "left" : { "type" : "reference", "section" : "_local", "key" : "x.y" },
                    "right" : { "type" : "reference", "section" : "_context", "key" : "a.b" },
                    "op": "eq"
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  },
  {
    "args": ["ASSEMBLE table0 COLUMN c0 FROM tables:table1 WHEN envelope:x.y == @a.b;"],
    "expects" : {
      "steps" : [
        {
          "name" : "assemble", "table_name" : "table0", "columns" : [
            {
              "table" : { "type" : "reference", "section" : "tables", "key" : "table1" },
              "sources" : [{
                "source": "c0", "name" : "c0", "expr" : {
                "left" : { "type" : "reference", "section" : "envelope", "key" : "x.y" },
                "right" : { "type" : "reference", "section" : "_context", "key" : "a.b" },
                "op": "eq" }
              }]
            }
          ]
        }
      ]
    }
  },
  {
    "args": ["ASSEMBLE table0 COLUMN c0 AS nc0 FROM tables:table1 WHEN envelope:x.y <= 2;"],
    "expects" : {
      "steps" : [
        {
          "name" : "assemble", "table_name" : "table0", "columns" : [
            {
              "table" : { "type" : "reference", "section" : "tables", "key" : "table1" },
              "sources" : [
                { "source" : "c0", "name" : "nc0", "expr" : { "left" : { "type" : "reference", "section" : "envelope", "key" : "x.y" }, "right" : { "type" : "number", "value" : "2" }, "op": "lte" } }
              ]
            }
          ]
        }
      ]
    }
  },
  {
    "args": ["ASSEMBLE table0 COLUMN c0 AS nc0 FROM tables:table1 WHEN envelope:x.y <= 2 COLUMN c1 AS nc1 FROM tables:table1 WHEN nc0 == 3 COLUMN b0 AS nc2 FROM tables:table2 WHEN envelope:p.q == 3;"],
    "expects" : {
      "steps" : [
        {
          "name" : "assemble", "table_name" : "table0", "columns" : [
            {
              "table" : { "type" : "reference", "section" : "tables", "key" : "table1" },
              "sources" : [
                { "source" : "c0", "name" : "nc0", "expr" : { "left" : { "type" : "reference", "section" : "envelope", "key" : "x.y" }, "right" : { "type" : "number", "value" : "2" }, "op" : "lte" } },
                { "source" : "c1", "name" : "nc1", "expr" : { "left" : { "type" : "reference", "section" : "_local", "key": "nc0" }, "right" : { "type" : "number", "value" : "3" }, "op": "eq" } }
              ]
            },
            {
              "table" : { "type" : "reference", "section" : "tables", "key" : "table2" },
              "sources" : [
                { "source" : "b0", "name" : "nc2", "expr" : { "left" : { "type" : "reference", "section" : "envelope", "key" : "p.q" }, "right" : { "type" : "number", "value" : "3" }, "op": "eq" } }
              ]
            }
          ]
        }
      ]
    }
  },
  {
    "args": ["ASSEMBLE table0 COLUMNS FROM tables:table1;"],
    "expects" : {
      "steps" : [
        {
          "name" : "assemble", "table_name" : "table0", "columns" : [
            {
              "table" : { "type" : "reference", "section" : "tables", "key" : "table1" },
              "sources" : [
                { "columns" : [] }
              ]
            }
          ]
        }
      ]
    }
  },
  {
    "args": ["ASSEMBLE table0 COLUMNS (c0, c1, c2) FROM tables:table1;"],
    "expects" : {
      "steps" : [
        {
          "name" : "assemble", "table_name" : "table0", "columns" : [
            {
              "table" : { "type" : "reference", "section" : "tables", "key" : "table1" },
              "sources" : [
                { "columns" : ["c0", "c1", "c2"] }
              ]
            }
          ]
        }
      ]
    }
  }
]
  
