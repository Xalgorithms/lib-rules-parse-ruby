[
  // simple assignment/copy
  {
    "args" : ["MAP tables:items USING a = @x.y.z;"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "tables", "key" : "items" },
          "assignments" : [
            { "target" : "a", "source" : { "type" : "reference", "section" : "_context", "key" : "x.y.z" } }
          ]
        }
      ]
    }
  },
  {
    "args" : ["MAP tables:items USING a.b.c = @x.y.z;"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "tables", "key" : "items" },
          "assignments" : [
            { "target" : "a.b.c", "source" : { "type" : "reference", "section" : "_context", "key" : "x.y.z" } }
          ]
        }
      ]
    }
  },
  // reference the vtable
  {
    "args" : ["MAP $ USING a = @x.y.z;"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "_virtual" },
          "assignments" : [
            { "target": "a", "source" : { "type" : "reference", "section" : "_context", "key" : "x.y.z" } }
          ]
        }
      ]
    }
  },
  // multiple assignments
  {
    "args" : ["MAP tables:items USING a = @x.y.z USING b=@p.q USING c = 2 USING d='s';"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "tables", "key" : "items" },
          "assignments" : [
            { "target": "a", "source" : { "type" : "reference", "section" : "_context", "key" : "x.y.z" } },
            { "target": "b", "source" : { "type" : "reference", "section" : "_context", "key" : "p.q" } },
            { "target": "c", "source" : { "type" : "number", "value" : "2" } },
            { "target": "d", "source" : { "type" : "string", "value" : "s" } }
          ]
        }
      ]
    }
  },
  {
    "args" : ["MAP tables:items USING a = multiply(add(@b, 2), 4);"],
    "expects" : {
      "steps" : [
        {
          "name" : "map",
          "table" : { "type" : "reference", "section" : "tables", "key" : "items" },
          "assignments" : [
            {
              "target" : "a",
              "source" : {
                "type" : "function",
                "name" : "multiply",
                "args" : [
                  {
                    "type" : "function",
                    "name" : "add",
                    "args" : [
                      { "type" : "reference", "section" : "_context", "key" : "b" },
                      { "type" : "number", "value" : "2" }
                    ]
                  },
                  { "type" : "number", "value" : "4" }
                ]
              }
            }
          ]
        }
      ]
    }
  }
]
